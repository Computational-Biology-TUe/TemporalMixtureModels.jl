<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multivariate · TemporalMixtureModels.jl</title><meta name="title" content="Multivariate · TemporalMixtureModels.jl"/><meta property="og:title" content="Multivariate · TemporalMixtureModels.jl"/><meta property="twitter:title" content="Multivariate · TemporalMixtureModels.jl"/><meta name="description" content="Documentation for TemporalMixtureModels.jl."/><meta property="og:description" content="Documentation for TemporalMixtureModels.jl."/><meta property="twitter:description" content="Documentation for TemporalMixtureModels.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="TemporalMixtureModels.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TemporalMixtureModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../univariate/">Univariate</a></li><li class="is-active"><a class="tocitem" href>Multivariate</a><ul class="internal"><li><a class="tocitem" href="#Prerequisites"><span>Prerequisites</span></a></li><li><a class="tocitem" href="#Generating-Synthetic-Data"><span>Generating Synthetic Data</span></a></li><li><a class="tocitem" href="#Fitting-a-Multivariate-Temporal-Mixture-Model"><span>Fitting a Multivariate Temporal Mixture Model</span></a></li></ul></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../api/components/">Model Components</a></li><li><a class="tocitem" href="../../api/mixtures/">Mixture Models</a></li><li><a class="tocitem" href="../../api/fitting/">Fitting Models</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Multivariate</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multivariate</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Computational-Biology-TUe/TemporalMixtureModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Computational-Biology-TUe/TemporalMixtureModels.jl/blob/main/docs/src/tutorials/multivariate.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Multivariate-Model"><a class="docs-heading-anchor" href="#Multivariate-Model">Multivariate Model</a><a id="Multivariate-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Multivariate-Model" title="Permalink"></a></h1><p>In this section, we will demonstrate how to fit a multivariate temporal mixture model using the <code>TemporalMixtureModels.jl</code> package. We will use synthetic data for this example.</p><h2 id="Prerequisites"><a class="docs-heading-anchor" href="#Prerequisites">Prerequisites</a><a id="Prerequisites-1"></a><a class="docs-heading-anchor-permalink" href="#Prerequisites" title="Permalink"></a></h2><p>While the package uses an internal data structure for the time series data, the package by default implements automatic conversion from a <code>DataFrame</code> to its internal format. </p><pre><code class="language-julia hljs">using TemporalMixtureModels, DataFrames</code></pre><h2 id="Generating-Synthetic-Data"><a class="docs-heading-anchor" href="#Generating-Synthetic-Data">Generating Synthetic Data</a><a id="Generating-Synthetic-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-Synthetic-Data" title="Permalink"></a></h2><p>We will generate some synthetic multivariate time series data. The data will consist of two variables, each generated from different polynomial functions with added Gaussian noise. The input DataFrame should be a so-called &quot;long&quot; format, with columns for the individual ID, time points, variable names, and observed values.</p><pre><code class="language-julia hljs"># Set random seed for reproducibility
using Random
Random.seed!(1234)

# Generate time points
individuals_per_group = [20, 30]
t_values = 0:0.1:10
n_groups = 2

group_coefficients_y = [ [2.0, -0.5, 0.05],  # Group 1: y = 2 - 0.5*t + 0.05*t^2
                       [1.0, 0.3, -0.02] ] # Group 2: y = 1 + 0.3*t - 0.02*t^2
group_coefficients_z = [ [0.5, 0.4, -0.03],  # Group 1: z = 0.5 + 0.4*t - 0.03*t^2
                       [3.0, -0.2, 0.04] ] # Group 2: z = 3 - 0.2*t + 0.04*t^2

ids = Int[]
timepoints = Float64[]
measurements_y = Float64[]
measurements_z = Float64[]
for group in 1:n_groups
    id_start = sum(individuals_per_group[1:group-1]) + 1
    id_end = sum(individuals_per_group[1:group])
    for individual in id_start:id_end
        for t in t_values
            y = group_coefficients_y[group][1] + group_coefficients_y[group][2]*t + group_coefficients_y[group][3]*t^2 + randn()*0.25
            z = group_coefficients_z[group][1] + group_coefficients_z[group][2]*t + group_coefficients_z[group][3]*t^2 + randn()*0.25
            push!(ids, individual)
            push!(timepoints, t)
            push!(measurements_y, y)
            push!(measurements_z, z)
        end
    end
end

input_data = DataFrame(id = [ids; ids], time = [timepoints; timepoints], value = [measurements_y; measurements_z], var_name = repeat([&quot;y&quot;, &quot;z&quot;], inner=length(ids)))
first(input_data, 5)  # Display the first 5 rows of the DataFrame</code></pre><div><div style = "float: left;"><span>5×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">id</th><th style = "text-align: left;">time</th><th style = "text-align: left;">value</th><th style = "text-align: left;">var_name</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">1.91007</td><td style = "text-align: left;">y</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.1</td><td style = "text-align: right;">1.8456</td><td style = "text-align: left;">y</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">2.00706</td><td style = "text-align: left;">y</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.3</td><td style = "text-align: right;">2.36819</td><td style = "text-align: left;">y</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.4</td><td style = "text-align: right;">1.73177</td><td style = "text-align: left;">y</td></tr></tbody></table></div><p>Here you can see the first few rows of the generated DataFrame. Each row corresponds to a measurement for a specific individual at a specific time point for one of the two variables.</p><h2 id="Fitting-a-Multivariate-Temporal-Mixture-Model"><a class="docs-heading-anchor" href="#Fitting-a-Multivariate-Temporal-Mixture-Model">Fitting a Multivariate Temporal Mixture Model</a><a id="Fitting-a-Multivariate-Temporal-Mixture-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-a-Multivariate-Temporal-Mixture-Model" title="Permalink"></a></h2><p>Now that we have our synthetic multivariate data, we can fit a multivariate temporal mixture model using the <code>fit!</code> function. We will use polynomial regression models as the component models for this example. We will specify the number of components (clusters) we expect in the data.</p><p>We first define the model, specifying the number of components and the type of component models to use for each variable. In this case, we will use polynomial regression models of degree 2 for both variables.</p><pre><code class="language-julia hljs"># Define the number of components and the component models for each variable
n_components = 2
component_models = Dict(:y =&gt; PolynomialRegression(2), :z =&gt; PolynomialRegression(2))
model = MultivariateMixtureModel(n_components, component_models)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultivariateMixtureModel{Float64}(Dict{Symbol, TemporalMixtureModels.AbstractMixtureModelComponent{Float64}}[Dict(:y =&gt; PolynomialRegression{Float64}(2, [0.0, 0.0, 0.0]), :z =&gt; PolynomialRegression{Float64}(2, [0.0, 0.0, 0.0])), Dict(:y =&gt; PolynomialRegression{Float64}(2, [0.0, 0.0, 0.0]), :z =&gt; PolynomialRegression{Float64}(2, [0.0, 0.0, 0.0]))], [0.5, 0.5], [0.0 0.0; 0.0 0.0], -Inf, false, 0)</code></pre><p>We can now fit the model to our data using the <code>fit!</code> function. This function takes the model and the input DataFrame as arguments and performs the fitting process.</p><pre><code class="language-julia hljs"># Fit the model to the data
fit!(model, input_data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultivariateMixtureModel{Float64}(Dict{Symbol, TemporalMixtureModels.AbstractMixtureModelComponent{Float64}}[Dict(:y =&gt; PolynomialRegression{Float64}(2, [1.0005471675119773, 0.29730782662765787, -0.019680612927625955]), :z =&gt; PolynomialRegression{Float64}(2, [2.9833876700157558, -0.1948543443396753, 0.03967899708946765])), Dict(:y =&gt; PolynomialRegression{Float64}(2, [1.98633556351034, -0.48904758236841955, 0.04867909688884508]), :z =&gt; PolynomialRegression{Float64}(2, [0.5069300712194061, 0.39836390116509673, -0.029734077768493152]))], [0.6, 0.4], [0.061580955471056006 0.0643541024198967; 0.06267539351032858 0.05976239625697861], -357.09848322308216, true, 3)</code></pre><p>As with the univariate case, we can also estimate the uncertainty of the fitted model parameters using the <code>bootstrap_ci</code> function. This function performs bootstrap resampling to compute confidence intervals for the model parameters.</p><pre><code class="language-julia hljs"># Compute bootstrap confidence intervals
n_bootstrap = 100  # Number of bootstrap samples
confidence_intervals, _ = bootstrap_ci(model, input_data; n_bootstrap=n_bootstrap)
confidence_intervals</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 Dict{Symbol, Any}(:y =&gt; (lower = [0.9777883917870603, 0.2876007762445627, -0.020338176148768546], upper = [1.0267758220338905, 0.3041904063304761, -0.018883592062307095]), :z =&gt; (lower = [2.9571897917084833, -0.20564872844080367, 0.038524797569084834], upper = [3.0172107496373997, -0.18165510104695098, 0.04061399684471874]))
 Dict{Symbol, Any}(:y =&gt; (lower = [1.9410436374714606, -0.5056756860524578, 0.04717293399643091], upper = [2.024336455771562, -0.47032897754477737, 0.05012472023555149]), :z =&gt; (lower = [0.48102522010885146, 0.3861485908135129, -0.03062011920669294], upper = [0.5396725851808255, 0.40817937597514264, -0.028840212950910746]))</code></pre><p>The output shows the confidence intervals for the parameters of each component model and variable in the mixture. We can use these intervals and the fitted model to visualize the results.</p><pre><code class="language-julia hljs">using CairoMakie

# Create a range of time points for prediction
t_pred = 0:0.1:10

# Prepare a figure
figure_mixture = let f = Figure()

    # Plot the fitted component models
    predictions = predict(model, t_pred)

    COMPONENT_COLORS = [colorant&quot;#c74300&quot;, colorant&quot;#008aa1&quot;]

    for (axi, variable) in enumerate([:y, :z])
        ax = Axis(f[1, axi], xlabel=&quot;Time&quot;, ylabel=&quot;Value&quot;, title=&quot;Temporal Mixture, variable: $variable&quot;)
        # Plot the original data points
        scatter!(ax, input_data[input_data[!,:var_name] .== String(variable),:time], input_data[input_data[!,:var_name] .== String(variable),:value]; color=:gray, markersize=2, label=&quot;Data - $variable&quot;)
        for k in axes(predictions[variable], 2)
            lines!(ax, t_pred, predictions[variable][:, k];
            label=&quot;Component $k - $variable&quot;, color=COMPONENT_COLORS[k], linewidth=2)

            # get the confidence bounds. This is still a bit clunky because there is no API for this yet
            lower_bound_parameters = confidence_intervals[k][variable][:lower]
            upper_bound_parameters = confidence_intervals[k][variable][:upper]

            model_lb = PolynomialRegression(2, lower_bound_parameters)
            model_ub = PolynomialRegression(2, upper_bound_parameters)

            y_lower = predict(model_lb, t_pred)
            y_upper = predict(model_ub, t_pred)

            # Plot the confidence intervals as shaded areas
            band!(ax, t_pred, y_lower, y_upper;
            color=(COMPONENT_COLORS[k], 0.3), label=&quot;Component $k - $variable&quot;)
        end
    end

    f
end
figure_mixture</code></pre><img src="04169314.png" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../univariate/">« Univariate</a><a class="docs-footer-nextpage" href="../../api/components/">Model Components »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 29 September 2025 10:11">Monday 29 September 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
